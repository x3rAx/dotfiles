#exec_always --no-startup-id bash -c 'env >/tmp/env.txt'
#exec_always --no-startup-id killall sxhkd ; sxhkd /home/x3ro/.config/i3/sxhkdrc


# This file has been auto-generated by i3-config-wizard(1).
# It will not be overwritten, so edit it as you like.
#
# Should you change your keyboard layout some time, delete
# this file and re-run i3-config-wizard(1).
#

# i3 config file (v4)
#
# Please see https://i3wm.org/docs/userguide.html for a complete reference!

# Setup modifier key.
# Alt = Mod1
# Win = Mod4
set $mod Mod4
set $alt Mod1
set $shift Shift
set $ctrl Ctrl

set $resize_delta 5px or 5ppt
set $resize_delta_fine 1px or 1ppt
set $move_delta 10px
set $move_delta2 30px

# Theme
set $bg-color           "#2f343f"
set $bg-color-2         "#2f343f"
set $bg-color-urgent    "#E53935"
set $text-color         "#f3f4f5"
set $text-color-2       "#676E7D"
set $indicator          "#5294E2"
set $color-active       "#5294E2"

set $indicator-inactive $text-color-2

set $i3scripts ~/.config/i3/scripts

# Focus folows mouse
focus_follows_mouse yes

popup_during_fullscreen leave_fullscreen

# Font for window titles. Will also be used by the bar unless a different font
# is used in the bar {} block below.
#font pango:monospace 8
font pango:System San Francisco Display 9

# This font is widely installed, provides lots of unicode glyphs, right-to-left
# text rendering and scalability on retina/hidpi displays (thanks to pango).
#font pango:DejaVu Sans Mono 8

# Before i3 v4.8, we used to recommend this one as the default:
# font -misc-fixed-medium-r-normal--13-120-75-75-C-70-iso10646-1
# The font above is very space-efficient, that is, it looks good, sharp and
# clear in small sizes. However, its unicode glyph coverage is limited, the old
# X core fonts rendering does not support right-to-left and this being a bitmap
# font, it doesn’t scale on retina/hidpi displays.

# Use Mouse+$mod to drag floating windows to their wanted position
floating_modifier $mod

set $workspace_1  "1 "
set $workspace_2  "2"
set $workspace_3  "3"
set $workspace_4  "4"
set $workspace_5  "5"
set $workspace_6  "6"
set $workspace_7  "7"
set $workspace_8  "8"
set $workspace_9  "9"
set $workspace_10 "10"
set $workspace_11 "11"
set $workspace_12 "12"
set $workspace_13 "13"
set $workspace_14 "14"
set $workspace_15 "15"
set $workspace_16 "16"
set $workspace_17 "17"
set $workspace_18 "18"
set $workspace_19 "19"
set $workspace_20 "20"
set $workspace_21 "21"
set $workspace_22 "22"



# resize window (you can also use the mouse for that)
bindsym $mod+r mode "resize"
mode "resize" {
        # These bindings trigger as soon as you enter the resize mode

        # Pressing left will shrink the window’s width.
        # Pressing right will grow the window’s width.
        # Pressing up will shrink the window’s height.
        # Pressing down will grow the window’s height.
        bindsym j          resize shrink width  $resize_delta
        bindsym k          resize grow   height $resize_delta
        bindsym l          resize shrink height $resize_delta
        bindsym odiaeresis resize grow   width  $resize_delta

        # same bindings, but for the arrow keys
        bindsym Left  resize shrink width  $resize_delta
        bindsym Down  resize grow   height $resize_delta
        bindsym Up    resize shrink height $resize_delta
        bindsym Right resize grow   width  $resize_delta

        # back to normal: Enter or Escape
        bindsym Return mode "default"
        bindsym Escape mode "default"
}

# move floating window (you can also use the mouse for that)
bindsym $mod+m focus floating; mode "move"
mode "move" {
        # These bindings trigger as soon as you enter the resize mode

        # bindings for home row
        bindsym j          move left  $move_delta
        bindsym k          move up    $move_delta
        bindsym l          move down  $move_delta
        bindsym odiaeresis move right $move_delta

        bindsym Shift+j          move left  $move_delta2
        bindsym Shift+k          move down  $move_delta2
        bindsym Shift+l          move up    $move_delta2
        bindsym Shift+odiaeresis move right $move_delta2

        bindsym $alt+j            move

        # same bindings, but for the arrow keys
        bindsym Left  move left  $move_delta
        bindsym Down  move down  $move_delta
        bindsym Up    move up    $move_delta
        bindsym Right move right $move_delta

        bindsym Shift+Left  move left  $move_delta2
        bindsym Shift+Down  move down  $move_delta2
        bindsym Shift+Up    move up    $move_delta2
        bindsym Shift+Right move right $move_delta2

        # move to center of screen
        bindsym space move position center

        # Move to workspace
        bindsym 1   move container to workspace $workspace_1
        bindsym 2   move container to workspace $workspace_2
        bindsym 3   move container to workspace $workspace_3
        bindsym 4   move container to workspace $workspace_4
        bindsym 5   move container to workspace $workspace_5
        bindsym 6   move container to workspace $workspace_6
        bindsym 7   move container to workspace $workspace_7
        bindsym 8   move container to workspace $workspace_8
        bindsym 9   move container to workspace $workspace_9
        bindsym 0   move container to workspace $workspace_10
        bindsym F1  move container to workspace $workspace_11
        bindsym F2  move container to workspace $workspace_12
        bindsym F3  move container to workspace $workspace_13
        bindsym F4  move container to workspace $workspace_14
        bindsym F5  move container to workspace $workspace_15
        bindsym F6  move container to workspace $workspace_16
        bindsym F7  move container to workspace $workspace_17
        bindsym F8  move container to workspace $workspace_18
        bindsym F9  move container to workspace $workspace_19
        bindsym F10 move container to workspace $workspace_20
        bindsym F11 move container to workspace $workspace_21
        bindsym F12 move container to workspace $workspace_22

        # back to normal: Enter or Escape
        bindsym Return mode "default"
        bindsym Escape mode "default"

}

bindsym $mod+$alt+x mode "exec"
mode "exec" {
    set $default mode "default"
#    bindsym b $exec opera, $default
#    bindsym c $exec code, $default
#    bindsym e $exec nemo, $default
#    bindsym g $exec smartgit, $default
#    bindsym m $exec spotify, $default
#    bindsym p $exec phpstorm, $default
#    bindsym r $exec $TERMINAL -e ranger, $default
#    bindsym t $exec telegram, $default
#    bindsym x $exec opera, $default
#
#    #bindsym k $exec urxvt -e xkill, $default
#
#    set $execTerminal exec xrdb -merge ~/.Xresources && urxvt
#    bindsym Return $execTerminal, $default
    bindsym Escape $default
}

# window colors
#                       border             background         text                 indicator
client.focused          $bg-color          $color-active      $text-color          $indicator
client.unfocused        $bg-color-2        $bg-color-2        $text-color-2        $indicator-inactive
client.focused_inactive $bg-color-2        $bg-color-2        $text-color-2        $indicator-inactive
client.urgent           $bg-color-urgent   $bg-color-urgent   $text-color          $indicator-inactive


# Start i3bar to display a workspace bar (plus the system information i3status
# finds out, if available)
bar {
    position top
    status_command i3blocks -c ~/.config/i3/i3blocks/config
    #status_command ~/Projects/x3ro/i3barkeeper/bin/i3barkeeper
    tray_output primary

    colors {
        background $bg-color
        separator #757575
        #                  border             background         text
        focused_workspace  $color-active      $color-active      $text-color
        inactive_workspace $bg-color-2        $bg-color-2        $text-color
        urgent_workspace   $bg-color-urgent   $bg-color-urgent   $text-color
    }
}

# =======================
# === CUSTOM SETTINGS ===
# =======================


set $exec exec --no-startup-id
set $exec_always exec_always --no-startup-id
# lock time in minutes
#set $i3lock_time 10
# screen off time after lock in seconds
#set $i3lock_time_screen_off 120
set $i3lock_screen_off 600
set $i3lock_lock_delay 60
set $i3lock_lock_screen_off 30

$exec_always "$i3scripts/autolock '$i3lock_screen_off' '$i3lock_lock_delay' '$i3lock_lock_screen_off'"
#$exec_always "$i3scripts/autolock '$i3lock_time' '$i3lock_time_screen_off'"
#$exec_always "xautolock -exit"
#$exec_always "xautolock -time $i3lock_time -locker '$i3lock' -detectsleep"
#$exec_always "~/.local/bin/xset-dpms $(($i3lock_time * 60 + $i3lock_time_screen_off))"


for_window [class="^.*"] border pixel 1

set $gaps_inner 20
set $gaps_outer 4
gaps inner $gaps_inner
gaps outer $gaps_outer


# Window rules [#window-rules]
# Window workspaces
for_window [class="copyq" instance="copyq"] floating enable
for_window [class="Nitrogen"] floating enable
#for_window [class="Opera"] move container to workspace $workspace_1
for_window [class="Tor Browser"] floating enable
for_window [class="KeePass2"] floating enable
for_window [class="TeamViewer"] floating enable
for_window [class="TeamViewer" title="Sponsored session"] $exec bash ~/.local/bin/teamviewer-close-sponsored-session
for_window [class="Evolution" window_role="^EMailBrowser-"] floating enable
#for_window [class="Evolution" window_role="^EShellWindow-"] move container to workspace $workspace_9
for_window [class="^Evolution$"] move container to workspace $workspace_9
for_window [class="^Evolution-alarm-notify$"] floating enable
#for_window [class="Firefox"] bindsym $mod+t $exec notify-send hello
for_window [class="Pavucontrol"] floating enable
#for_window [class="HipChat"] move container to workspace $workspace_10
for_window [class="Glade-previewer"] floating enable
for_window [class="Key-mon"] floating enable
for_window [class="Key-mon"] border none
for_window [class="albert"] border none
for_window [class="Blueman-manager"] floating enable
for_window [class="Connman-gtk"] floating enable
for_window [class="Nm-connection-editor"] floating enable
#for_window [class="Gnome-terminal"] floating enable
#for_window [class="Gnome-terminal"] move down, resize set 500px 300px
for_window [class="Gnome-terminal"] resize set 600px 300px
for_window [class="Slack"] move container to workspace $workspace_10

$exec i3-msg workspace "1 "
$exec sxhkd-auto-restart ~/.config/i3/sxhkdrc
$exec_always pkill -USR1 -x sxhkd

# Fix touchpad
#exec --no-startup-id xinput set-prop 11 282 1
#exec --no-startup-id xinput set-prop 11 290 1

# Startup Applications [#startup #autostart]
  # TODO: QuickFix: restart gnome-keyring-daemon to make it work at least without auto-unlock.
$exec /usr/bin/gnome-keyring-daemon -r --components=pkcs11,secrets,ssh
$exec nm-applet
#$exec connman-gtk
$exec copyq
#$exec telegram-desktop -startintray
$exec telegram-desktop
for_window [class="TelegramDesktop"] move container to workspace $workspace_22
$exec signal-desktop --start-in-tray
$exec dropbox
#$exec_always "nitrogen --restore && sleep 1 && nitrogen --restore"
$exec_always feh --bg-fill "$HOME/.config/x3ro/background-image.png"
$exec albert
$exec_always killall compton ; compton #--config ~/.config/compton-hidpi.conf
$exec numlockx on
#$exec fluxgui
$exec system-config-printer-applet
#$exec bash ~/.local/bin/teamviewer-tray
$exec bash ~/.local/bin/anydesk-tray
#$exec rambox
$exec evolution
$exec mail-notification
#$exec hipchat4
$exec linphone --iconified
$exec blueman-applet
#$exec slack --startup
$exec slack

# fn-Keys: media, volume  brightness
#   https://faq.i3wm.org/question/3747/enabling-multimedia-keys/?answer=3759#post-id-3759


# Screenshot with scrot
# Pulse Audio controls
set $cmd-update-volume pkill -RTMIN+10 i3blocks

# To use default sink use "" without quotes.
bindsym XF86AudioRaiseVolume $exec "pactl set-sink-volume @DEFAULT_SINK@ +2%; $cmd-update-volume"
bindsym XF86AudioLowerVolume $exec "pactl set-sink-volume @DEFAULT_SINK@ -2%; $cmd-update-volume"
bindsym XF86AudioMute $exec "pactl set-sink-mute @DEFAULT_SINK@ toggle; $cmd-update-volume"

# Use "pactl list sinks" to find out sink names
set $pa-volume ~/.config/i3/scripts/pa-volume
bindsym $mod+XF86AudioRaiseVolume $exec "$pa-volume set-volume bluez_sink +2%; $cmd-update-volume"
bindsym $mod+XF86AudioLowerVolume $exec "$pa-volume set-volume bluez_sink -2%; $cmd-update-volume"
bindsym $mod+XF86AudioMute $exec "$pa-volume set-mute bluez_sink toggle; $cmd-update-volume"

# Sreen brightness controls
bindsym XF86MonBrightnessUp $exec xbacklight -inc 10 # increase screen brightness
bindsym $ctrl+XF86MonBrightnessUp $exec xbacklight -inc 2 # increase screen brightness
bindsym XF86MonBrightnessDown $exec xbacklight -dec 10 # decrease screen brightness
bindsym $ctrl+XF86MonBrightnessDown $exec xbacklight -dec 2 # decrease screen brightness

# Touchpad controls
bindsym XF86TouchpadToggle $exec touchpad-toggle # toggle touchpad

# Media player controls
bindsym XF86AudioPlay $exec playerctl play-pause
bindsym XF86AudioPause $exec playerctl play-pause
bindsym XF86AudioNext $exec playerctl next
bindsym XF86AudioPrev $exec playerctl previous
bindsym XF86AudioStop $exec playerctl pause

# Wifi Toggle
bindsym XF86WLAN $exec "wifi toggle; sleep 1; pkill -RTMIN+11 i3blocks"

# Keyboard layout (EUR)
bindsym $mod+$alt+m $exec kill $(pidof gkbd-keyboard-display) || gkbd-keyboard-display -l "$(setxkbmap -query | grep -P '^layout:' | awk '{print $2}')"

# Toggle copyq
bindsym $mod+backslash $exec copyq toggle
